# IIIF Integration Visual Guide

This document provides visual explanations and illustrations to help understand the IIIF integration process in Zenodo-RDM, making complex concepts accessible to all developers.

## Table of Contents

1. [IIIF Architecture Overview](#iiif-architecture-overview)
2. [Image Conversion Process](#image-conversion-process)
3. [File Locations and Naming](#file-locations-and-naming)
4. [IIIF URL Structure](#iiif-url-structure)
5. [IIIF Viewer Components](#iiif-viewer-components)
6. [Troubleshooting Visuals](#troubleshooting-visuals)

## IIIF Architecture Overview

### Complete System Architecture

```
┌───────────────────────────────────────────────────────────────────────────┐
│                             Zenodo-RDM System                             │
│                                                                           │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐ │
│  │             │    │             │    │             │    │             │ │
│  │  Web UI     │───▶│  API        │───▶│  Database   │◀───│  Storage    │ │
│  │             │    │             │    │             │    │             │ │
│  └─────┬───────┘    └─────┬───────┘    └─────────────┘    └─────┬───────┘ │
│        │                  │                                     │         │
└────────┼──────────────────┼─────────────────────────────────────┼─────────┘
         │                  │                                     │          
         │                  │                                     │          
┌────────▼──────────────────▼─────────────────────────────────────▼─────────┐
│                             IIIF Components                               │
│                                                                           │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐ │
│  │             │    │             │    │             │    │             │ │
│  │  Viewer     │◀───│  Manifest   │◀───│  Image API  │◀───│  PTIF Files │ │
│  │  (Browser)  │    │  (Metadata) │    │  (IIPServer)│    │             │ │
│  │             │    │             │    │             │    │             │ │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘ │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

### Data Flow Diagram

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│             │     │             │     │             │     │             │
│  Upload     │────▶│  Store      │────▶│  Convert    │────▶│  Access     │
│  Image      │     │  Image      │     │  to PTIF    │     │  via IIIF   │
│             │     │             │     │             │     │             │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

### Component Interaction

```
  Browser                   Zenodo-RDM                  IIPServer
    │                           │                           │
    │ 1. Request record page    │                           │
    │ ─────────────────────────▶                           │
    │                           │                           │
    │ 2. HTML with IIIF viewer  │                           │
    │ ◀─────────────────────────                           │
    │                           │                           │
    │ 3. Request IIIF manifest  │                           │
    │ ─────────────────────────▶                           │
    │                           │                           │
    │ 4. IIIF manifest (JSON)   │                           │
    │ ◀─────────────────────────                           │
    │                           │                           │
    │ 5. Request image tiles    │                           │
    │ ──────────────────────────────────────────────────────▶
    │                           │                           │
    │ 6. Image tiles (JPEG)     │                           │
    │ ◀──────────────────────────────────────────────────────
    │                           │                           │
```

## Image Conversion Process

### PTIF File Structure

```
┌───────────────────────────────┐
│ Original TIF Image            │
│                               │
│ ┌───────────────────────────┐ │
│ │                           │ │
│ │                           │ │
│ │                           │ │
│ │                           │ │
│ │                           │ │
│ │                           │ │
│ │                           │ │
│ └───────────────────────────┘ │
└───────────────────────────────┘
             │
             ▼
┌───────────────────────────────┐
│ Pyramid TIF (PTIF)            │
│                               │
│ ┌───────────────────────────┐ │
│ │ Full Resolution           │ │
│ └───────────────────────────┘ │
│ ┌───────────┐                 │
│ │ 1/2 Res.  │                 │
│ └───────────┘                 │
│ ┌─────┐                       │
│ │1/4  │                       │
│ └─────┘                       │
│ ┌─┐                           │
│ │ │ Thumbnail                 │
│ └─┘                           │
└───────────────────────────────┘
```

### Conversion Workflow

```
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│               │     │               │     │               │
│  Input Image  │────▶│  kdu_compress │────▶│  PTIF Output  │
│  (TIF/JPG)    │     │  Conversion   │     │  File         │
│               │     │               │     │               │
└───────────────┘     └───────────────┘     └───────┬───────┘
                                                    │
                                                    ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│               │     │               │     │               │
│  IIPServer    │◀────│  Copy to      │◀────│  Rename with  │
│  Access       │     │  IIPServer    │     │  Pattern      │
│               │     │               │     │               │
└───────────────┘     └───────────────┘     └───────────────┘
```

## File Locations and Naming

### Directory Structure

```
├── Zenodo-RDM
│   ├── data/
│   │   └── images/
│   │       └── private/
│   │           └── 202/
│   │               ├── page-001.tif
│   │               ├── page-002.tif
│   │               └── ...
│   └── ...
│
├── Docker Containers
│   ├── iipserver/
│   │   ├── /images/
│   │   │   ├── private/
│   │   │   │   └── 202/
│   │   │   │       └── ... (original location, doesn't work)
│   │   │   │
│   │   │   └── public/
│   │   │       ├── private_202_page-001.ptif
│   │   │       ├── private_202_page-002.ptif
│   │   │       └── ... (working location)
│   │   └── ...
│   └── ...
```

### File Naming Convention

```
Original file:    data/images/private/202/page-001.tif
                  │      │      │     │    └── Filename
                  │      │      │     └── Record ID
                  │      │      └── Access level
                  │      └── Content type
                  └── Data directory

PTIF file:        /images/public/private_202_page-001.ptif
                  │      │      │          │       └── Extension
                  │      │      │          └── Original filename
                  │      │      └── Combination of access level and record ID
                  │      └── IIPServer expected directory
                  └── IIPServer root directory

IIIF URL path:    /private_202_page-001.ptif
                  │         │      └── Original filename with PTIF extension
                  └── Combined prefix of access level and record ID
```

## IIIF URL Structure

### IIIF Image API URL Components

```
http://localhost:8080/fcgi-bin/iipsrv.fcgi?IIIF=/private_202_page-001.ptif/full/200,/0/default.jpg
│     │         │    │      │           │    │      │   │   │ │ │    │    │    │
│     │         │    │      │           │    │      │   │   │ │ │    │    │    └── Format
│     │         │    │      │           │    │      │   │   │ │ │    │    │
│     │         │    │      │           │    │      │   │   │ │ │    │    │
│     │         │    │      │           │    │      │   │   │ │ │    │    └── Color quality
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    │
│     │         │    │      │           │    │      │   │   │ │ │    └── Rotation angle
│     │         │    │      │           │    │      │   │   │ │ │
│     │         │    │      │           │    │      │   │   │ │ └── Rotation
│     │         │    │      │           │    │      │   │   │ │
│     │         │    │      │           │    │      │   │   │ └── Size delimiter
│     │         │    │      │           │    │      │   │   │
│     │         │    │      │           │    │      │   │   └── Height (maintain aspect ratio)
│     │         │    │      │           │    │      │   │
│     │         │    │      │           │    │      │   │
│     │         │    │      │           │    │      │   └── Width
│     │         │    │      │           │    │      │
│     │         │    │      │           │    │      └── Size keyword "full"
│     │         │    │      │           │    │
│     │         │    │      │           │    └── Region keyword "full"
│     │         │    │      │           │
│     │         │    │      │           └── Image identifier (PTIF file)
│     │         │    │      │
│     │         │    │      └── IIIF parameter
│     │         │    │
│     │         │    └── IIPServer CGI script
│     │         │
│     │         └── Port
│     │
│     └── Host
│
└── Protocol
```

### IIIF URL Examples

#### Metadata Request

```
http://localhost:8080/fcgi-bin/iipsrv.fcgi?IIIF=/private_202_page-001.ptif/info.json
```

This URL requests the metadata (dimensions, available sizes, tile info) for the image.

#### Full Image Request

```
http://localhost:8080/fcgi-bin/iipsrv.fcgi?IIIF=/private_202_page-001.ptif/full/full/0/default.jpg
```

This URL requests the entire image at full resolution.

#### Thumbnail Request

```
http://localhost:8080/fcgi-bin/iipsrv.fcgi?IIIF=/private_202_page-001.ptif/full/200,/0/default.jpg
```

This URL requests a thumbnail that is 200 pixels wide, maintaining aspect ratio.

#### Region Request

```
http://localhost:8080/fcgi-bin/iipsrv.fcgi?IIIF=/private_202_page-001.ptif/100,100,200,200/full/0/default.jpg
```

This URL requests a 200x200 pixel region starting at coordinates (100,100).

## IIIF Viewer Components

### OpenSeadragon Viewer Anatomy

```
┌─────────────────────────────────────────────────────────────────┐
│ OpenSeadragon Viewer                                            │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                         │    │
│  │                                                         │    │
│  │                                                         │    │
│  │                 Image Display Area                      │    │
│  │                                                         │    │
│  │                                                         │    │
│  │                                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────────────────┐   │
│  │ Home│ │Zoom │ │Zoom │ │ Full│ │Rotate│ │   Navigator    │   │
│  │     │ │  +  │ │  -  │ │Screen│ │     │ │                │   │
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Custom Viewer Interface Layout

```
┌─────────────────────────────────────────────────────────────────────────┐
│ IIIF Image Viewer                                                       │
│                                                                         │
│  ┌─────────────────────────────────────┐  ┌─────────────────────────┐   │
│  │ Record ID: [    202     ] [Load]    │  │ Image Information       │   │
│  │ Filename:  [  page-001   ]          │  │                         │   │
│  └─────────────────────────────────────┘  │ Width: 1982             │   │
│                                           │ Height: 2831            │   │
│  ┌─────────────────────────────────────┐  │ Tile Size: 256x256      │   │
│  │                                     │  │ Format: JPEG            │   │
│  │                                     │  │                         │   │
│  │                                     │  └─────────────────────────┘   │
│  │       OpenSeadragon Viewer          │                                │
│  │                                     │  ┌─────────────────────────┐   │
│  │                                     │  │ Thumbnails              │   │
│  │                                     │  │                         │   │
│  └─────────────────────────────────────┘  │ ┌───┐ ┌───┐ ┌───┐ ┌───┐ │   │
│                                           │ │ 1 │ │ 2 │ │ 3 │ │ 4 │ │   │
│                                           │ └───┘ └───┘ └───┘ └───┘ │   │
│                                           │                         │   │
│                                           │ ┌───┐ ┌───┐ ┌───┐ ┌───┐ │   │
│                                           │ │ 5 │ │ 6 │ │ 7 │ │ 8 │ │   │
│                                           │ └───┘ └───┘ └───┘ └───┘ │   │
│                                           └─────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## Troubleshooting Visuals

### Common Error Decision Tree

```
┌──────────────────┐
│ IIIF Not Working │
└────────┬─────────┘
         │
    ┌────┴─────┐
    │          │
┌───▼──┐    ┌──▼───┐
│ PTIF │    │ IIIF │
│Issues│    │Access│
└──┬───┘    └───┬──┘
   │            │
┌──▼───┐    ┌───▼──┐
│Missing│    │Wrong │
│ Files │    │ URLs │
└──┬───┘    └───┬──┘
   │            │
┌──▼───┐    ┌───▼──┐
│Conv. │    │Path  │
│Failed│    │Issues│
└──┬───┘    └───┬──┘
   │            │
┌──▼───┐    ┌───▼──┐
│Check │    │Check │
│Scripts│    │Config│
└──────┘    └──────┘
```

### Error Message Visual Guide

```
┌─────────────────────────────────────────────────────────────────┐
│ Common Error Messages and Solutions                             │
│                                                                 │
│  ERROR MESSAGE                  CAUSE               SOLUTION    │
│ ┌───────────────────────┐ ┌────────────────┐ ┌───────────────┐ │
│ │ "File not found"      │ │ PTIF file not  │ │ Check path    │ │
│ │ from IIPServer        │ │ in right place │ │ and naming    │ │
│ └───────────────────────┘ └────────────────┘ └───────────────┘ │
│                                                                 │
│ ┌───────────────────────┐ ┌────────────────┐ ┌───────────────┐ │
│ │ "Invalid Accept       │ │ Manifest API   │ │ Use direct    │ │
│ │ header" error         │ │ configuration  │ │ image access  │ │
│ └───────────────────────┘ └────────────────┘ └───────────────┘ │
│                                                                 │
│ ┌───────────────────────┐ ┌────────────────┐ ┌───────────────┐ │
│ │ "kdu_compress         │ │ Missing        │ │ Install       │ │
│ │ not found"            │ │ dependencies   │ │ Kakadu tools  │ │
│ └───────────────────────┘ └────────────────┘ └───────────────┘ │
│                                                                 │
│ ┌───────────────────────┐ ┌────────────────┐ ┌───────────────┐ │
│ │ "CORS policy          │ │ Missing CORS   │ │ Add CORS      │ │
│ │ blocked access"       │ │ headers        │ │ headers       │ │
│ └───────────────────────┘ └────────────────┘ └───────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Debugging Screenshots

Here's what you should see at each step:

1. **Browser Developer Console with IIIF Requests**

   This shows the Network tab with successful and failed IIIF requests:

   ```
   Network Tab
   ------------------------------------------------------------
   Name                            Status  Type      Size  Time
   ------------------------------------------------------------
   info.json                       200     json      1 KB  45ms
   default.jpg                     200     image     6 KB  78ms
   0,0,256,256/256,/0/default.jpg  200     image     4 KB  52ms
   manifest                        406     json      91 B  123ms
   ```

2. **Successful IIIF Image Load**

   When everything is working, you'll see a high-resolution image with zoom capabilities:

   ```
   ┌────────────────────────────────────────────────────┐
   │ IIIF Viewer                                        │
   │                                                    │
   │  ┌────────────────────────────────────────────┐    │
   │  │                                            │    │
   │  │                                            │    │
   │  │                                            │    │
   │  │  [High-quality image visible here with     │    │
   │  │   pan and zoom controls]                   │    │
   │  │                                            │    │
   │  │                                            │    │
   │  │                                            │    │
   │  └────────────────────────────────────────────┘    │
   │                                                    │
   └────────────────────────────────────────────────────┘
   ```

3. **IIPServer File Structure When Correct**

   The correct file structure in IIPServer:

   ```
   /images/public/
   ├── private_202_page-001.ptif
   ├── private_202_page-002.ptif
   ├── private_202_page-003.ptif
   └── ... etc
   ``` 